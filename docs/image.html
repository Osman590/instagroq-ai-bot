<!-- docs/image.html -->
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- FIX: –∑–∞–ø—Ä–µ—Ç zoom/pinch + double-tap zoom + safe-area -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É —Å—Ä–∞–∑—É -->
  <script>
    (function(){
      const KEY = "miniapp_theme_v1";
      function getTheme(){
        const url = new URL(window.location.href);
        const qp = url.searchParams.get("theme");
        if (qp) return qp;
        try{ return localStorage.getItem(KEY) || "blue"; }catch(e){ return "blue"; }
      }
      document.documentElement.setAttribute("data-theme", getTheme());
    })();
  </script>

  <!-- FIX iOS/webview: pinch/gesture + double-tap zoom -->
  <script>
    (function(){
      document.addEventListener("gesturestart", (e) => e.preventDefault(), { passive:false });
      document.addEventListener("gesturechange", (e) => e.preventDefault(), { passive:false });
      document.addEventListener("gestureend", (e) => e.preventDefault(), { passive:false });

      let lastTouchEnd = 0;
      document.addEventListener("touchend", (e) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) e.preventDefault();
        lastTouchEnd = now;
      }, { passive:false });

      document.addEventListener("dblclick", (e) => e.preventDefault(), { passive:false });
    })();
  </script>

  <!-- –±–∞–∑–æ–≤–∞—è —Ç–µ–º–∞/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ -->
  <link rel="stylesheet" href="./css/index.css?v=3">

  <!-- —Å—Ç–∏–ª–∏ –≤–∫–ª–∞–¥–∫–∏ -->
  <link rel="stylesheet" href="./css/image.css?v=7">

  <!-- ‚úÖ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –∞–Ω–∏–º–∞—Ü–∏–π -->
  <link rel="stylesheet" href="./css/image.anim.css?v=1">
</head>

<body>
  <div class="imgTop">
    <a class="imgBack" id="backBtn" href="./index.html">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="imgTitle">üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫</div>
    <div class="imgSpacer"></div>
  </div>

  <div class="imgWrap" id="chatZone">
    <div class="imgCard imgShell">

      <!-- SCREEN 1: –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ -->
      <section class="screen screenActive" id="screenPick" aria-hidden="false">
        <div class="screenHead">
          <div class="screenKicker">–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞</div>
          <div class="screenSub">
            –í—ã–±–µ—Ä–∏, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å: –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç–∏–Ω–∫—É.
          </div>
        </div>

        <div class="modeList" id="modeList" role="list"></div>
      </section>

      <!-- SCREEN 2: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ -->
      <section class="screen" id="screenGen" aria-hidden="true">
        <div class="genHeader">
          <div class="genMeta">
            <div class="genTitleRow">
              <div class="genTitle" id="modeTitle">–†–µ–∂–∏–º</div>
              <button class="genChange" id="changeModeBtn" type="button">–°–º–µ–Ω–∏—Ç—å</button>
            </div>

            <div class="genBadges">
              <div class="badge badgePrice" id="modePrice">4 cr.</div>
              <div class="badge badgeModel" id="modeModel">SD 3.5 Flash</div>
            </div>

            <div class="genDesc" id="modeDesc">
              –û–ø–∏—à–∏, —á—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å ‚Äî –∏ –º—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É.
            </div>
          </div>
        </div>

        <!-- INPUT AREA -->
        <div class="genBlock" id="inputBlock">
          <div class="imgRow" id="btnRow">
            <button class="imgBtn2" id="galleryBtn" type="button">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è</button>
            <button class="imgBtn" id="genBtn" type="button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>

          <input id="fileInput" type="file" accept="image/*" style="display:none" />

          <div class="imgPromptBox" id="promptBox">
            <div class="imgPreview" id="previewWrap" hidden>
              <img id="previewImg" alt="preview" />
              <button class="imgRemove" id="removeImgBtn" type="button" aria-label="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É">‚úï</button>
            </div>

            <textarea
              class="imgPrompt"
              id="prompt"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ, 4k"
            ></textarea>
          </div>
        </div>

        <!-- RESULT AREA -->
        <div class="imgResult" id="result">
          <div class="loadBox" id="loading" hidden>
            <div class="spinner" aria-hidden="true"></div>
            <div class="loadText">–ò–¥—ë—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è‚Ä¶</div>
          </div>

          <div class="imgPlaceholder" id="placeholder">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
          <img class="imgOut" id="outImg" alt="result" hidden />
        </div>

        <!-- BOTTOM ACTION -->
        <div class="bottomRow" id="bottomRow" hidden>
          <button class="imgBtn bottomBtn" id="againBtn" type="button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>

      </section>
    </div>
  </div>

  <script type="module" src="./js/image.js?v=7"></script>
</body>
</html>