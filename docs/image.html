<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É —Å—Ä–∞–∑—É -->
  <script>
    (function(){
      const KEY = "miniapp_theme_v1";
      function getTheme(){
        const url = new URL(window.location.href);
        const qp = url.searchParams.get("theme");
        if (qp) return qp;
        try{ return localStorage.getItem(KEY) || "blue"; }catch(e){ return "blue"; }
      }
      document.documentElement.setAttribute("data-theme", getTheme());
    })();
  </script>

  <!-- FIX iOS/webview: pinch/gesture + double-tap zoom -->
  <script>
    (function(){
      document.addEventListener("gesturestart", (e) => e.preventDefault(), { passive:false });
      document.addEventListener("gesturechange", (e) => e.preventDefault(), { passive:false });
      document.addEventListener("gestureend", (e) => e.preventDefault(), { passive:false });

      let lastTouchEnd = 0;
      document.addEventListener("touchend", (e) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) e.preventDefault();
        lastTouchEnd = now;
      }, { passive:false });

      document.addEventListener("dblclick", (e) => e.preventDefault(), { passive:false });
    })();
  </script>

  <link rel="stylesheet" href="./css/index.css?v=3">
  <link rel="stylesheet" href="./css/image.css?v=1">
</head>

<body class="pageIn">
  <div class="imgTop">
    <a class="imgBack" id="backBtn" href="./index.html">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="imgTitle">üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫</div>
    <div class="imgSpacer"></div>
  </div>

  <div class="imgWrap" id="chatZone">
    <div class="imgCard" id="cardRoot">

      <!-- SCREEN: MODE LIST -->
      <section id="modeScreen">
        <div class="screenTitle">–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞</div>
        <div class="screenDesc">–í—ã–±–µ—Ä–∏, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å. –¶–µ–Ω–∞ —É–∫–∞–∑–∞–Ω–∞ –≤ –∑–≤—ë–∑–¥–∞—Ö ‚≠êÔ∏è.</div>

        <div class="modeList" id="modeList"></div>
      </section>

      <!-- SCREEN: GENERATE -->
      <section id="genScreen" hidden>
        <div class="genHeader">
          <div class="genHeaderLeft">
            <span class="genChip" id="selectedModeChip">–†–µ–∂–∏–º</span>
            <span class="genChipPrice" id="selectedModePrice">‚Äî</span>
          </div>
          <button class="genChange" id="changeModeBtn" type="button">–°–º–µ–Ω–∏—Ç—å</button>
        </div>

        <div class="genDesc" id="genDesc">
          –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞.
        </div>

        <!-- ACTIONS -->
        <div class="imgRow" id="actionsRow">
          <button class="imgBtn2" id="galleryBtn" type="button">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è</button>
          <button class="imgBtn" id="genBtn" type="button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>

        <input id="fileInput" type="file" accept="image/*" style="display:none" />

        <!-- PROMPT BOX -->
        <div class="imgPromptBox" id="promptBox">
          <div class="imgPreview" id="previewWrap" hidden>
            <img id="previewImg" alt="preview" />
            <button class="imgRemove" id="removeImgBtn" type="button" aria-label="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É">‚úï</button>
          </div>

          <textarea
            class="imgPrompt"
            id="prompt"
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ, 4k"
          ></textarea>
        </div>

        <!-- LOADING (–≤–º–µ—Å—Ç–æ –≤–≤–æ–¥–∞, –ù–ï —Å–Ω–∏–∑—É) -->
        <div class="imgLoading" id="loadingBox" hidden>
          <div class="loader"></div>
          <div class="loadingText">–ò–¥—ë—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è‚Ä¶</div>
        </div>

        <!-- RESULT (–≤–º–µ—Å—Ç–æ –≤–≤–æ–¥–∞) -->
        <div class="imgResult2" id="result2" hidden>
          <img class="imgOut" id="outImg" alt="result" />
        </div>

        <button class="regenBtn" id="regenBtn" type="button" hidden>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
      </section>

    </div>
  </div>

  <script type="module" src="./js/image.js?v=1"></script>
</body>
</html>