<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- FIX: –∑–∞–ø—Ä–µ—Ç zoom/pinch + double-tap zoom + safe-area -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É —Å—Ä–∞–∑—É -->
  <script>
    (function(){
      const KEY = "miniapp_theme_v1";
      function getTheme(){
        const url = new URL(window.location.href);
        const qp = url.searchParams.get("theme");
        if (qp) return qp;
        try{ return localStorage.getItem(KEY) || "blue"; }catch(e){ return "blue"; }
      }
      document.documentElement.setAttribute("data-theme", getTheme());
    })();
  </script>

  <!-- FIX iOS/webview: pinch/gesture + double-tap zoom -->
  <script>
    (function(){
      document.addEventListener("gesturestart", (e) => e.preventDefault(), { passive:false });
      document.addEventListener("gesturechange", (e) => e.preventDefault(), { passive:false });
      document.addEventListener("gestureend", (e) => e.preventDefault(), { passive:false });

      let lastTouchEnd = 0;
      document.addEventListener("touchend", (e) => {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) e.preventDefault();
        lastTouchEnd = now;
      }, { passive:false });

      document.addEventListener("dblclick", (e) => e.preventDefault(), { passive:false });
    })();
  </script>

  <!-- –±–∞–∑–æ–≤–∞—è —Ç–µ–º–∞/–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ -->
  <link rel="stylesheet" href="./css/index.css?v=3">
  <!-- —Å—Ç–∏–ª–∏ –≤–∫–ª–∞–¥–∫–∏ -->
  <link rel="stylesheet" href="./css/image.css?v=3">
</head>

<body>
  <div class="imgTop">
    <!-- ‚úÖ —Ç–µ–ø–µ—Ä—å —ç—Ç–∞ –∫–Ω–æ–ø–∫–∞ —É–º–µ–µ—Ç: –≤–Ω—É—Ç—Ä–∏ –≤–∫–ª–∞–¥–∫–∏ = –Ω–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É, –µ—Å–ª–∏ –º—ã –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
    <a class="imgBack" id="backBtn" href="./index.html">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="imgTitle" id="topTitle">üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫</div>
    <div class="imgSpacer"></div>
  </div>

  <div class="imgWrap" id="chatZone">
    <div class="imgCard">

      <!-- ‚úÖ –≠–ö–†–ê–ù –í–´–ë–û–†–ê –†–ï–ñ–ò–ú–ê -->
      <div id="modeView">
        <div class="imgHint">
          –í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º (–ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è). –ü–æ—Ç–æ–º –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
        </div>

        <div class="modeList" id="modeList">
          <!-- –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–∑–¥–∞—ë—Ç JS -->
        </div>
      </div>

      <!-- ‚úÖ –≠–ö–†–ê–ù –ì–ï–ù–ï–†–ê–¶–ò–ò -->
      <div id="genView" hidden>
        <div class="imgHint" id="modeHint">
          –í—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) –∏ –Ω–∞–ø–∏—à–∏ –ø—Ä–æ–º–ø—Ç.
        </div>

        <!-- –ì–∞–ª–µ—Ä–µ—è -->
        <div class="imgRow">
          <button class="imgBtn2" id="galleryBtn" type="button">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è</button>
          <button class="imgBtn" id="genBtn" type="button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>

        <input id="fileInput" type="file" accept="image/*" style="display:none" />

        <!-- –ü—Ä–µ–≤—å—é + —Ç–µ–∫—Å—Ç -->
        <div class="imgPromptBox" id="promptBox">
          <div class="imgPreview" id="previewWrap" hidden>
            <img id="previewImg" alt="preview" />
            <button class="imgRemove" id="removeImgBtn" type="button" aria-label="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É">‚úï</button>
          </div>

          <textarea
            class="imgPrompt"
            id="prompt"
            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ, 4k"
          ></textarea>
        </div>

        <div class="imgResult" id="result">
          <div class="imgPlaceholder" id="placeholder">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞</div>
          <img class="imgOut" id="outImg" alt="result" hidden />
        </div>
      </div>

    </div>
  </div>

  <script type="module" src="./js/image.js?v=3"></script>
</body>
</html>