<!-- 1/7 -->
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- Важно: запрещаем double-tap zoom -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>AI Chat</title>

  <!-- Telegram WebApp API -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --vh: 100vh;
      --topH: 52px; /* высота панели без safe-area */
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif; }

    /* ✅ iPhone-like фон: ровный тёмно-синий, без осветления в центре */
    body{
      background: linear-gradient(180deg,#0a2344 0%, #071a33 40%, #061628 100%);
      color:#fff;
      display:flex;
      flex-direction:column;
      height: var(--vh);
      overflow:hidden;
      touch-action: manipulation;
      -webkit-text-size-adjust: 100%;
    }

    /* ✅ TOP как iOS: полностью “стекло”, и чат виден под панелью */
    .top{
      position: fixed;
      left: 0;
      right: 0;
      top: 0;
      z-index: 20;

      display:flex;
      align-items:center;
      gap:10px;

      /* чуть уже */
      height: var(--topH);
      padding: 8px 14px;
      padding-top: calc(8px + env(safe-area-inset-top));

      /* реально прозрачное стекло */
      background: rgba(255,255,255,.03);
      backdrop-filter: blur(34px) saturate(210%);
      -webkit-backdrop-filter: blur(34px) saturate(210%);

      border-bottom: 1px solid rgba(255,255,255,.08);
      box-shadow: none;
    }

    .top a{ color:rgba(210,230,255,.95); text-decoration:none; font-size:16px; }
    .title{ font-weight:700; font-size:17px; }
    .spacer{ flex:1; }
    
    <!-- 2/7 -->
    .gear{
      width:36px;
      height:36px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-size:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      backdrop-filter: blur(14px) saturate(180%);
      -webkit-backdrop-filter: blur(14px) saturate(180%);
      box-shadow: 0 8px 20px rgba(0,0,0,.22);
    }

    /* ✅ чат с отступом под fixed top */
    .chat{
      flex:1 1 auto;
      padding:16px;
      padding-top: calc(var(--topH) + env(safe-area-inset-top) + 12px);
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
      touch-action: manipulation;
    }

    /* ✅ пузыри iOS vibe (чуть мягче) */
    .msg{
      max-width:78%;
      padding:12px 14px;
      border-radius:18px;
      line-height:1.35;
      font-size:15px;
      white-space:pre-wrap;
      word-break:break-word;
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
    }
    .bot{
      align-self:flex-start;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(12px) saturate(160%);
      -webkit-backdrop-filter: blur(12px) saturate(160%);
    }
    .user{
      align-self:flex-end;
      background: linear-gradient(180deg,#3aa0ff 0%, #0a84ff 100%);
      border: 1px solid rgba(255,255,255,.12);
    }

    /* ✅ нижняя панель ввода iOS glass (оставил твой стиль) */
    .input{
      flex:0 0 auto;
      display:flex;
      gap:10px;
      padding:12px;
      border-top:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(28px) saturate(200%);
      -webkit-backdrop-filter: blur(28px) saturate(200%);
      box-shadow: 0 -10px 30px rgba(0,0,0,.22);
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    
    <!-- 3/7 -->
    /* ✅ поле ввода — ещё ближе к iOS */
    .input input{
      flex:1;
      padding:14px 16px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.25);
      outline:none;
      font-size:15px;
      color:#0b1220;
      background: rgba(255,255,255,.94);
      box-shadow: 0 8px 22px rgba(0,0,0,.18);
      caret-color:#0a84ff;
    }

    /* ✅ кнопка отправки — iMessage vibe */
    .input button{
      padding:0 18px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.18);
      font-size:16px;
      font-weight:800;
      background: linear-gradient(180deg,#4da6ff 0%, #0a84ff 100%);
      color:#fff;
      box-shadow: 0 10px 24px rgba(10,132,255,.28);
    }

    /* ✅ лёгкое затемнение под fixed-панелями */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background: linear-gradient(
        180deg,
        rgba(0,0,0,.12) 0%,
        rgba(0,0,0,0) 18%,
        rgba(0,0,0,0) 82%,
        rgba(0,0,0,.18) 100%
      );
    }
    
    <!-- 4/7 -->
    /* ✅ пузыри сообщений — стекло как iOS */
    .msg{
      max-width:78%;
      padding:12px 14px;
      border-radius:20px;
      line-height:1.35;
      font-size:15px;
      white-space:pre-wrap;
      word-break:break-word;
      box-shadow: 0 8px 22px rgba(0,0,0,.16);
    }

    /* бот — светлое стекло */
    .bot{
      align-self:flex-start;
      background: rgba(255,255,255,.22);
      border:1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(18px) saturate(160%);
      -webkit-backdrop-filter: blur(18px) saturate(160%);
      color:#0b1220;
    }

    /* пользователь — iMessage синий */
    .user{
      align-self:flex-end;
      background: linear-gradient(180deg,#5fb2ff 0%, #0a84ff 100%);
      border:1px solid rgba(255,255,255,.18);
      color:#fff;
    }
    
    <!-- 5/7 -->
    /* ✅ нижняя панель ввода — iOS glass */
    .input{
      flex:0 0 auto;
      display:flex;
      gap:10px;
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.10);

      /* стекло */
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(30px) saturate(180%);
      -webkit-backdrop-filter: blur(30px) saturate(180%);

      box-shadow: 0 -8px 24px rgba(0,0,0,.25);
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }

    /* поле ввода — как iOS */
    .input input{
      flex:1;
      padding:14px 16px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.22);
      outline:none;
      font-size:15px;

      background: rgba(255,255,255,.94);
      color:#0b1220;

      box-shadow: inset 0 1px 0 rgba(255,255,255,.6),
                  0 8px 18px rgba(0,0,0,.18);

      caret-color:#0a84ff;
    }

    /* кнопка отправки — iOS */
    .input button{
      padding:0 18px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.18);
      font-size:16px;
      font-weight:800;

      background: linear-gradient(180deg,#5fb2ff 0%, #0a84ff 100%);
      color:#fff;

      box-shadow: 0 10px 22px rgba(10,132,255,.28);
    }
    
    <!-- 6/7 -->
    /* ✅ пузыри сообщений — iOS стиль */

    .msg{
      max-width:78%;
      padding:12px 14px;
      border-radius:20px;
      line-height:1.35;
      font-size:15px;
      white-space:pre-wrap;
      word-break:break-word;

      /* мягкая тень как в iMessage */
      box-shadow:
        0 6px 18px rgba(0,0,0,.18),
        inset 0 1px 0 rgba(255,255,255,.25);
    }

    /* сообщение бота — стеклянный серо-белый */
    .bot{
      align-self:flex-start;

      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.22);

      backdrop-filter: blur(14px) saturate(160%);
      -webkit-backdrop-filter: blur(14px) saturate(160%);
    }

    /* сообщение пользователя — iMessage blue */
    .user{
      align-self:flex-end;

      background: linear-gradient(180deg,#4da3ff 0%, #0a84ff 100%);
      border:1px solid rgba(255,255,255,.16);

      box-shadow:
        0 8px 22px rgba(10,132,255,.35),
        inset 0 1px 0 rgba(255,255,255,.35);
    }
    
    <!-- 7/7 -->
<!-- ✅ финальная проверка: ничего в логике не меняем, только визуал iOS -->

<style>
/* Чуть усилим эффект «сквозной» верхней панели над чатом */
.top{
  position: sticky;
  top: 0;
  z-index: 10;

  background: rgba(255,255,255,.015);
  backdrop-filter: blur(32px) saturate(200%);
  -webkit-backdrop-filter: blur(32px) saturate(200%);

  border-bottom: 1px solid rgba(255,255,255,.08);
}

/* Чтобы чат реально был виден ПОД панелью */
.chat{
  padding-top: 12px;
}

/* Мелкая айфон-деталь: плавные анимации */
.msg,
.top,
.input,
.sheet{
  transition: background .25s ease, box-shadow .25s ease, border .25s ease;
}
</style>