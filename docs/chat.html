<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AI Chat</title>
  <style>
    :root{
      --vh: 100vh;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif}
    body{
      background: linear-gradient(180deg,#0b1f33,#071726);
      color:#fff;
      display:flex;
      flex-direction:column;
      height: var(--vh);
      overflow:hidden;
    }
    .top{
      display:flex;
      align-items:center;
      gap:10px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(8px);
      flex:0 0 auto;
    }
    .top a{color:#9cc8ff;text-decoration:none;font-size:16px}
    .title{font-weight:700;font-size:17px}
    .chat{
      flex:1 1 auto;
      padding:16px;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0; /* –≤–∞–∂–Ω–æ –¥–ª—è iOS */
    }
    .msg{
      max-width:78%;
      padding:12px 14px;
      border-radius:16px;
      line-height:1.35;
      font-size:15px;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .bot{align-self:flex-start;background: rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.14)}
    .user{align-self:flex-end;background: linear-gradient(180deg,#4da3ff,#2f6bff)}
    .input{
      flex:0 0 auto;
      display:flex;
      gap:10px;
      padding:12px;
      border-top:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.35);
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    .input input{
      flex:1;
      padding:14px;
      border-radius:14px;
      border:none;
      outline:none;
      font-size:15px;
    }
    .input button{
      padding:0 18px;
      border-radius:14px;
      border:none;
      font-size:16px;
      font-weight:700;
      background:#2f6bff;
      color:#fff;
    }
  </style>

  <!-- Telegram WebApp API -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

  <div class="top">
    <a href="./index.html">‚Üê</a>
    <div class="title">AI Chat</div>
  </div>

  <div class="chat" id="chat">
    <div class="msg bot">üëã –ü—Ä–∏–≤–µ—Ç! –Ø –ò–ò. –ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å.</div>
  </div>

  <div class="input">
    <input id="text" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶" autocomplete="off" />
    <button id="sendBtn">‚ñ∂</button>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    // 1) –ü—Ä–æ—Å–∏–º Telegram —Ä–∞—Å–∫—Ä—ã—Ç—å –º–∏–Ω–∏-–∞–ø–ø –Ω–∞ –º–∞–∫—Å–∏–º—É–º
    if (tg) {
      tg.ready();
      tg.expand(); // —É–±–∏—Ä–∞–µ—Ç "–ø–æ–ª–æ–≤–∏–Ω—É" –∏ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç
      // tg.requestFullscreen?.(); // –∏–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–æ, –Ω–æ expand –æ–±—ã—á–Ω–æ —Ö–≤–∞—Ç–∞–µ—Ç
    }

    // 2) –ë–æ—Ä—å–±–∞ —Å –¥–µ—Ä–≥–∞–Ω—å–µ–º: –∏—Å–ø–æ–ª—å–∑—É–µ–º tg viewport height, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
    function applyViewportHeight() {
      if (tg && typeof tg.viewportHeight === "number") {
        document.documentElement.style.setProperty("--vh", tg.viewportHeight + "px");
      } else {
        // –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        document.documentElement.style.setProperty("--vh", window.innerHeight + "px");
      }
    }

    applyViewportHeight();

    // Telegram —à–ª—ë—Ç —Å–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏/–∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    if (tg && tg.onEvent) {
      tg.onEvent("viewportChanged", () => {
        applyViewportHeight();
        // –º—è–≥–∫–æ —É–¥–µ—Ä–∂–∏–≤–∞–µ–º —á–∞—Ç –≤–Ω–∏–∑—É
        requestAnimationFrame(() => {
          chat.scrollTop = chat.scrollHeight;
        });
      });
    } else {
      // fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
      window.addEventListener("resize", () => {
        applyViewportHeight();
        requestAnimationFrame(() => {
          chat.scrollTop = chat.scrollHeight;
        });
      });
    }

    // ----- —á–∞—Ç –ª–æ–≥–∏–∫–∞ -----
    const chat = document.getElementById("chat");
    const input = document.getElementById("text");
    const sendBtn = document.getElementById("sendBtn");

    function add(type, text){
      const d = document.createElement("div");
      d.className = "msg " + type;
      d.textContent = text;
      chat.appendChild(d);
      chat.scrollTop = chat.scrollHeight;
    }

    function send(){
      const t = input.value.trim();
      if(!t) return;
      add("user", t);
      input.value = "";
      setTimeout(()=>add("bot","ü§ñ –ü—Ä–∏–Ω—è–ª. –ú–æ–≥—É —Ä–∞–∑–ª–æ–∂–∏—Ç—å –ø–æ —à–∞–≥–∞–º.\n\n\""+t+"\""), 250);
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") send();
    });

    // –ü—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –∏–Ω–ø—É—Ç–µ —Ç–æ–∂–µ —á—É—Ç—å –ø–æ–¥—Å—Ç—Ä–∞—Ö—É–µ–º—Å—è
    input.addEventListener("focus", () => {
      setTimeout(() => {
        applyViewportHeight();
        chat.scrollTop = chat.scrollHeight;
      }, 50);
    });
  </script>

</body>
</html>
